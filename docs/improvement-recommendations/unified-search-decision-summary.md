# ChatFlow統一検索機能 - 意思決定サマリー

## 📋 検討内容

### 現状の問題点
1. **分離された検索体験**: Sessions.tsx（セッション検索）とSearch.tsx（メッセージ検索）が別々
2. **ユーザビリティ課題**: どちらの検索を使うべきか迷う
3. **機能重複**: 類似の検索ロジックが複数箇所に存在
4. **発見性低下**: 関連情報を見つけにくい

### ユーザーの実際の検索ニーズ
```typescript
interface UserSearchPatterns {
  現在の問題: "セッション名がわからないと、メッセージ内容から関連セッションを見つけられない"
  理想の体験: "1つの検索で、セッション・メッセージ・タグすべてを横断検索したい"
  
  現在の問題: "Searchページでメッセージは見つかるが、セッション全体の文脈がわからない"
  理想の体験: "メッセージとそのセッション情報を同時に確認したい"
  
  現在の問題: "どの画面で検索すべきかわからず、複数画面を行き来する"
  理想の体験: "1つの検索画面ですべての情報にアクセスしたい"
}
```

---

## ✅ 決定事項

### 統一検索機能の採用
**決定**: Sessions.tsxとSearch.tsxを統合し、1つの統一検索画面を作成

### 統合方針
1. **段階的統合**: 既存機能を壊さずに段階的に統合
2. **後方互換性**: 既存URLルートの維持
3. **パフォーマンス重視**: SQLite FTS5を最大活用
4. **UX改善**: 直感的で高速な検索体験

### 技術アーキテクチャ
```typescript
interface UnifiedSearchArchitecture {
  backend: {
    newAPI: "POST /api/search/unified - 統一検索エンドポイント"
    service: "UnifiedSearchService - 複数ソース横断検索"
    performance: "SQLite FTS5による高速全文検索"
  }
  frontend: {
    component: "UnifiedSearch.tsx - 統合検索コンポーネント"
    features: ["リアルタイム検索", "高度フィルター", "タブ切り替え"]
    routing: "/search - 統一検索画面"
  }
}
```

### 実装計画
```typescript
interface ImplementationPlan {
  phase1: "API統合・基本UI実装（1-2週間）"
  phase2: "リアルタイム検索・フィルター実装（2-3週間）"
  phase3: "UX最適化・完成（1週間）"
  migration: "段階的移行・旧機能廃止（1ヶ月）"
}
```

---

## 🎯 期待効果

### 定量的改善
- **検索時間50%短縮**: 1画面で検索完結
- **コード削減30%**: 重複ロジックの統合
- **API呼び出し40%削減**: 並行検索による効率化

### 定性的改善
- **統一体験**: 一貫した検索体験の提供
- **発見性向上**: 思いがけない関連情報の発見
- **学習効果**: 1つの検索方法を覚えるだけで全機能活用

---

## 🚀 次のステップ

### 1. 実装準備
- [ ] テスト用ブランチ作成: `feature/unified-search-enhancement`
- [ ] 探索レポート作成（ChatFlow開発ルール準拠）
- [ ] 実装計画の詳細化

### 2. 開発着手判断
**実装に進むかどうかの最終確認**:
- [ ] 実装計画の承認
- [ ] 工数・スケジュールの確認
- [ ] 技術リスクの評価

### 3. 開発実行
承認後、以下の順序で実装：
1. Phase 1: API統合・基本UI（1-2週間）
2. Phase 2: 機能拡張（2-3週間）  
3. Phase 3: 最適化・完成（1週間）

---

## 📊 リスク評価

### 技術リスク（低）
- **既存機能への影響**: 段階的統合により最小化
- **パフォーマンス影響**: SQLite FTS5により高速化期待
- **複雑性増大**: 適切な設計により管理可能

### スケジュールリスク（低-中）
- **推定工数**: 4-5週間（テスト含む）
- **依存関係**: 既存検索機能との調整
- **品質保証**: 十分なテスト期間確保

### ユーザー影響（低）
- **学習コスト**: 既存検索より直感的
- **移行負担**: 段階的移行により最小化
- **後方互換性**: 既存URLルート維持

---

## 📝 承認・実装判断

### 推奨事項
**実装を推奨します**

### 理由
1. **明確なユーザー価値**: 検索体験の大幅改善
2. **技術的実現性**: 既存技術スタックで実現可能
3. **適切な工数**: 4-5週間で完成可能
4. **低リスク**: 段階的統合により安全

### 条件
- ChatFlow探索重視型開発ルールに従った実装
- 十分なテスト期間の確保
- 段階的リリースによるリスク最小化

---

**作成日**: 2025年6月04日  
**決定者**: ChatFlow開発チーム  
**次回レビュー**: 実装開始前 