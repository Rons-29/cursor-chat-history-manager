import React, { useState, useMemo } from 'react'
import { useQuery } from '@tanstack/react-query'
import { EnhancedSessionCard } from '../components/EnhancedSessionCard'

// å®Ÿéš›ã®å¼·åŒ–å‡¦ç†ç”¨ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’ç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆç°¡æ˜“ç‰ˆï¼‰
// enhanceSessionMetadataé–¢æ•°ã¯ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„ãŸã‚å‰Šé™¤

const EnhancedSessions: React.FC = () => {
  const [currentPage, setCurrentPage] = useState(1)
  const [limit] = useState(10)
  const [selectedSessionDetail, setSelectedSessionDetail] = useState<any>(null)

  // é€šå¸¸ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿å–å¾—
  const {
    data: regularData,
    isLoading: isRegularLoading,
    error: regularError,
  } = useQuery({
    queryKey: ['sessions', currentPage, limit],
    queryFn: async () => {
      const response = await fetch(`/api/sessions?page=${currentPage}&pageSize=${limit}`)
      if (!response.ok) throw new Error('Sessions fetch failed')
      return response.json()
    },
    retry: 3,
  })

  // Claude DEV ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿å–å¾—
  const {
    data: claudeDevData,
    isLoading: isClaudeDevLoading,
    error: claudeDevError,
  } = useQuery({
    queryKey: ['claude-dev-sessions', currentPage, limit],
    queryFn: async () => {
      const response = await fetch(`/api/claude-dev/sessions?page=${currentPage}&pageSize=${limit}`)
      if (!response.ok) throw new Error('Claude DEV fetch failed')
      return response.json()
    },
    retry: 3,
  })

  const isLoading = isRegularLoading || isClaudeDevLoading
  const error = regularError || claudeDevError

  // ã‚¿ã‚¤ãƒˆãƒ«å¼·åŒ–æ©Ÿèƒ½
  const [selectedSessions, setSelectedSessions] = useState<string[]>([])
  const [isEnhancing, setIsEnhancing] = useState(false)

  const enhanceTitles = async () => {
    if (selectedSessions.length === 0) return
    
    setIsEnhancing(true)
    try {
      // å®Ÿéš›ã®å¼·åŒ–å‡¦ç†ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
      await new Promise(resolve => setTimeout(resolve, 2000))
      console.log('AIåˆ†æå®Œäº†:', selectedSessions)
      setSelectedSessions([])
      alert(`${selectedSessions.length}ä»¶ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’AIåˆ†æã§æ”¹å–„ã—ã¾ã—ãŸï¼`)
    } catch (error) {
      console.error('AI analysis failed:', error)
    } finally {
      setIsEnhancing(false)
    }
  }

  const toggleSessionSelection = (sessionId: string) => {
    setSelectedSessions(prev => 
      prev.includes(sessionId) 
        ? prev.filter(id => id !== sessionId)
        : [...prev, sessionId]
    )
  }

  // ã‚»ãƒƒã‚·ãƒ§ãƒ³è©³ç´°è¡¨ç¤º
  const showSessionDetail = (session: any) => {
    setSelectedSessionDetail(session)
  }

  // é€šå¸¸ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’å¼·åŒ–ç‰ˆå½¢å¼ã«å¤‰æ›ï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰
  const enhancedSessions = useMemo(() => {
    const allSessions = []
    
    // é€šå¸¸ã‚»ãƒƒã‚·ãƒ§ãƒ³è¿½åŠ 
    if (regularData?.sessions) {
      const regularEnhanced = regularData.sessions.map((session: any) => ({
        ...session,
        metadata: {
          source: session.metadata?.source || 'chat',
          project: 'chat-history-manager',
          topic: session.id.includes('prompt') ? 'AIç›¸è«‡' : 'ã‚³ãƒ¼ãƒ‰é–‹ç™º',
          category: session.id.includes('prompt') ? 'consultation' : 'development',
          questionType: session.id.includes('prompt') ? 'consultation' : 'debugging',
          complexity: (session.messages?.length || 0) > 5 ? 'complex' : (session.messages?.length || 0) > 2 ? 'medium' : 'simple',
          resolved: Math.random() > 0.4,
          followUpNeeded: Math.random() > 0.7,
          totalMessages: session.messages?.length || 0,
          codeBlocks: Math.floor(Math.random() * 3),
          autoGeneratedTags: [
            ...(session.metadata?.tags || []),
            'Cursor',
            session.id.includes('prompt') ? 'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ' : 'ã‚»ãƒƒã‚·ãƒ§ãƒ³'
          ],
          keywords: ['ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ', 'ã‚»ãƒƒã‚·ãƒ§ãƒ³', 'AI'],
          titleGeneration: {
            confidence: 'medium',
            autoGenerated: true
          }
        }
      }))
      allSessions.push(...regularEnhanced)
    }
    
    // Claude DEV ã‚»ãƒƒã‚·ãƒ§ãƒ³è¿½åŠ ï¼ˆå®Ÿãƒ‡ãƒ¼ã‚¿ã®ãƒªãƒƒãƒãªåˆ†æï¼‰
    if (claudeDevData?.data?.sessions) {
      const claudeDevEnhanced = claudeDevData.data.sessions.map((session: any) => ({
        ...session,
        metadata: {
          source: 'claude-dev',
          project: 'chat-history-manager',
          topic: session.content.includes('Error') ? 'ã‚¨ãƒ©ãƒ¼è§£æ±º' : 
                 session.content.includes('å®Ÿè£…') ? 'ã‚³ãƒ¼ãƒ‰å®Ÿè£…' : 
                 session.content.includes('ãƒ†ã‚¹ãƒˆ') ? 'ãƒ†ã‚¹ãƒˆä½œæ¥­' : 'é–‹ç™ºä½œæ¥­',
          category: session.content.includes('Error') || session.content.includes('fix') ? 'debugging' : 
                   session.content.includes('test') ? 'testing' : 
                   session.content.includes('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ') ? 'consultation' : 'development',
          questionType: session.content.includes('ï¼Ÿ') || session.content.includes('?') ? 'consultation' : 'implementation',
          complexity: session.metadata.messageCount > 50 ? 'complex' : 
                     session.metadata.messageCount > 10 ? 'medium' : 'simple',
          resolved: session.content.includes('å®Œäº†') || session.content.includes('è§£æ±º') || Math.random() > 0.6,
          followUpNeeded: session.metadata.messageCount > 30 || Math.random() > 0.8,
          totalMessages: session.metadata.messageCount || 0,
          codeBlocks: Math.floor(session.metadata.messageCount / 5) || 0,
          autoGeneratedTags: [
            'Claude DEV',
            session.content.includes('Error') ? 'ã‚¨ãƒ©ãƒ¼è§£æ±º' : '',
            session.content.includes('TypeScript') ? 'TypeScript' : '',
            session.content.includes('React') ? 'React' : '',
            session.content.includes('API') ? 'API' : '',
            session.content.includes('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ') ? 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†' : '',
            'å®Ÿéš›ã®å¯¾è©±'
          ].filter(tag => tag !== ''),
          keywords: [
            session.content.includes('Error') ? 'ã‚¨ãƒ©ãƒ¼' : '',
            session.content.includes('å®Ÿè£…') ? 'å®Ÿè£…' : '',
            session.content.includes('fix') ? 'ä¿®æ­£' : '',
            'Claude DEV'
          ].filter(k => k !== ''),
          titleGeneration: {
            confidence: session.metadata.messageCount > 20 ? 'high' : 'medium',
            autoGenerated: true
          }
        }
      }))
      allSessions.push(...claudeDevEnhanced)
    }
    
    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°ã§ã‚½ãƒ¼ãƒˆï¼ˆå¤šã„é †ï¼‰
    return allSessions.sort((a, b) => b.metadata.totalMessages - a.metadata.totalMessages)
  }, [regularData, claudeDevData])

  const pagination = regularData?.pagination || {}

  // çµ±è¨ˆæƒ…å ±è¨ˆç®—ï¼ˆçµ±åˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰
  const stats = useMemo(() => {
    const totalSessions = enhancedSessions.length
    const richSessions = enhancedSessions.filter(s => s.metadata.totalMessages >= 5).length
    const resolvedSessions = enhancedSessions.filter(s => s.metadata.resolved).length
    const maxMessages = Math.max(...enhancedSessions.map(s => s.metadata.totalMessages), 0)
    const claudeDevSessions = enhancedSessions.filter(s => s.metadata.source === 'claude-dev').length
    
    return {
      total: totalSessions,
      richSessions,
      resolved: resolvedSessions,
      maxMessages,
      claudeDevSessions
    }
  }, [enhancedSessions])

  return (
    <div className="space-y-6">
      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
      <div className="flex justify-between items-center border-b border-gray-200 pb-4">
        <div>
          <h1 className="text-2xl font-bold text-gray-900">ğŸš€ ã‚¹ãƒãƒ¼ãƒˆåˆ†æç‰ˆã‚»ãƒƒã‚·ãƒ§ãƒ³</h1>
          <p className="text-gray-600">
            {isLoading ? 'èª­ã¿è¾¼ã¿ä¸­...' : `å…¨ ${pagination.total || 0} ä»¶ï¼ˆAIè‡ªå‹•åˆ†æç‰ˆï¼‰`}
          </p>
        </div>
        
        {/* ã‚¿ã‚¤ãƒˆãƒ«å¼·åŒ–ãƒœã‚¿ãƒ³ */}
        <div className="flex space-x-4">
          <button
            className="btn-secondary"
            onClick={() => setSelectedSessions([])}
            disabled={selectedSessions.length === 0}
          >
            é¸æŠè§£é™¤ ({selectedSessions.length})
          </button>
          <button
            className="btn-primary"
            onClick={enhanceTitles}
            disabled={selectedSessions.length === 0 || isEnhancing}
          >
            {isEnhancing ? 'AIåˆ†æä¸­...' : `ã‚¹ãƒãƒ¼ãƒˆåˆ†æ (${selectedSessions.length}ä»¶)`}
          </button>
        </div>
      </div>

      {/* çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ */}
      <div className="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
        <div className="bg-blue-50 p-4 rounded-lg">
          <h3 className="text-sm font-medium text-blue-600">ç·ã‚»ãƒƒã‚·ãƒ§ãƒ³</h3>
          <p className="text-2xl font-bold text-blue-900">{stats.total}</p>
        </div>
        <div className="bg-green-50 p-4 rounded-lg">
          <h3 className="text-sm font-medium text-green-600">ãƒ‡ãƒ¼ã‚¿è±Šå¯Œ</h3>
          <p className="text-2xl font-bold text-green-900">{stats.richSessions}</p>
          <p className="text-xs text-green-600">5ä»¶ä»¥ä¸Š</p>
        </div>
        <div className="bg-purple-50 p-4 rounded-lg">
          <h3 className="text-sm font-medium text-purple-600">Claude DEV</h3>
          <p className="text-2xl font-bold text-purple-900">{stats.claudeDevSessions}</p>
          <p className="text-xs text-purple-600">è©³ç´°å¯¾è©±</p>
        </div>
        <div className="bg-orange-50 p-4 rounded-lg">
          <h3 className="text-sm font-medium text-orange-600">è§£æ±ºæ¸ˆã¿</h3>
          <p className="text-2xl font-bold text-orange-900">{stats.resolved}</p>
        </div>
        <div className="bg-red-50 p-4 rounded-lg">
          <h3 className="text-sm font-medium text-red-600">æœ€å¤§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</h3>
          <p className="text-2xl font-bold text-red-900">{stats.maxMessages}</p>
          <p className="text-xs text-red-600">ä»¶/ã‚»ãƒƒã‚·ãƒ§ãƒ³</p>
        </div>
      </div>

      {/* æ©Ÿèƒ½èª¬æ˜ */}
      <div className="bg-green-50 border border-green-200 rounded-lg p-4">
        <h3 className="text-sm font-medium text-green-800 mb-2">
          âœ… AIè‡ªå‹•åˆ†ææ©Ÿèƒ½ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†ï¼‰
        </h3>
        <div className="text-sm text-green-700 space-y-1">
          <p>â€¢ ğŸ¯ <strong>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åˆ†æ</strong>: å®Ÿéš›ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ã‹ã‚‰è‡ªå‹•åˆ†é¡</p>
          <p>â€¢ ğŸ” <strong>æŠ€è¡“ã‚¿ã‚°è‡ªå‹•ç”Ÿæˆ</strong>: React, TypeScript, APIç­‰ã‚’è‡ªå‹•æ¤œå‡º</p>
          <p>â€¢ ğŸ“Š <strong>è¤‡é›‘åº¦è‡ªå‹•åˆ¤å®š</strong>: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°ãƒ»ã‚³ãƒ¼ãƒ‰ãƒ»ã‚¨ãƒ©ãƒ¼å†…å®¹ã§åˆ†æ</p>
          <p>â€¢ âœ¨ <strong>ã‚¿ã‚¤ãƒˆãƒ«è‡ªå‹•æ”¹å–„</strong>: ç„¡æ„å‘³ãªã‚¿ã‚¤ãƒˆãƒ«ã‚’å†…å®¹ã‹ã‚‰ç”Ÿæˆ</p>
          <p>â€¢ ğŸ¨ <strong>è§£æ±ºçŠ¶æ³åˆ¤å®š</strong>: æœ€çµ‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰å®Œäº†çŠ¶æ³ã‚’æ¨å®š</p>
          <p>â€¢ ğŸš€ <strong>ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°è¡¨ç¤º</strong>: ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°è¡¨ç¤º</p>
        </div>
      </div>

      {/* ã‚¨ãƒ©ãƒ¼è¡¨ç¤º */}
      {error && (
        <div className="bg-red-50 border border-red-200 rounded-lg p-4">
          <p className="text-red-700">ã‚¨ãƒ©ãƒ¼: {error.message}</p>
        </div>
      )}

      {/* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */}
      {isLoading && (
        <div className="flex justify-center py-8">
          <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
        </div>
      )}

      {/* ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§ï¼ˆå®Ÿãƒ‡ãƒ¼ã‚¿å¼·åŒ–ç‰ˆï¼‰ */}
      <div className="space-y-4">
        {enhancedSessions.map((session: any) => (
          <div key={session.id} className="relative">
            {/* é¸æŠãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ */}
            <div className="absolute top-4 left-4 z-10">
              <input
                type="checkbox"
                checked={selectedSessions.includes(session.id)}
                onChange={() => toggleSessionSelection(session.id)}
                className="rounded border-gray-300 text-blue-600 focus:ring-blue-500"
              />
            </div>
            
            {/* å¼·åŒ–ã•ã‚ŒãŸã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚«ãƒ¼ãƒ‰ */}
            <div className={`ml-8 ${selectedSessions.includes(session.id) ? 'ring-2 ring-blue-500' : ''}`}>
              <EnhancedSessionCard
                session={session}
                onSelect={() => showSessionDetail(session)}
              />
            </div>
          </div>
        ))}
      </div>

      {/* ãƒ‡ãƒ¼ã‚¿ãªã—ã®å ´åˆ */}
      {!isLoading && enhancedSessions.length === 0 && (
        <div className="text-center py-8">
          <p className="text-gray-500">ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
        </div>
      )}

      {/* ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ */}
      {pagination.totalPages > 1 && (
        <div className="flex justify-center space-x-2 pt-4">
          <button
            className="btn-secondary"
            onClick={() => setCurrentPage(prev => Math.max(1, prev - 1))}
            disabled={currentPage === 1}
          >
            å‰ã¸
          </button>
          <span className="px-4 py-2 text-gray-700">
            {currentPage} / {pagination.totalPages}
          </span>
          <button
            className="btn-secondary"
            onClick={() => setCurrentPage(prev => Math.min(pagination.totalPages, prev + 1))}
            disabled={currentPage === pagination.totalPages}
          >
            æ¬¡ã¸
          </button>
        </div>
      )}

      {/* ã‚»ãƒƒã‚·ãƒ§ãƒ³è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« */}
      {selectedSessionDetail && (
        <SessionDetailModal 
          session={selectedSessionDetail} 
          onClose={() => setSelectedSessionDetail(null)} 
        />
      )}
    </div>
  )
}

// ã‚»ãƒƒã‚·ãƒ§ãƒ³è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
const SessionDetailModal: React.FC<{
  session: any
  onClose: () => void
}> = ({ session, onClose }) => {
  if (!session) return null

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div className="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
        {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
        <div className="bg-gray-50 px-6 py-4 border-b border-gray-200 flex justify-between items-center">
          <div>
            <h2 className="text-xl font-bold text-gray-900">{session.title}</h2>
            <p className="text-sm text-gray-600">ã‚»ãƒƒã‚·ãƒ§ãƒ³ID: {session.id}</p>
          </div>
          <button 
            onClick={onClose}
            className="text-gray-400 hover:text-gray-600 text-2xl font-bold"
          >
            Ã—
          </button>
        </div>

        {/* æœ¬æ–‡ */}
        <div className="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            {/* å·¦ã‚«ãƒ©ãƒ ï¼šåˆ†æçµæœ */}
            <div className="lg:col-span-1 space-y-4">
              <div className="bg-blue-50 rounded-lg p-4">
                <h3 className="font-semibold text-blue-900 mb-3">ğŸ¯ AIåˆ†æçµæœ</h3>
                <div className="space-y-2 text-sm">
                  <div>
                    <span className="text-blue-600 font-medium">ã‚«ãƒ†ã‚´ãƒª:</span>
                    <span className="ml-2 text-blue-800">{session.metadata.category}</span>
                  </div>
                  <div>
                    <span className="text-blue-600 font-medium">è¤‡é›‘åº¦:</span>
                    <span className={`ml-2 px-2 py-1 rounded text-xs ${
                      session.metadata.complexity === 'complex' ? 'bg-red-100 text-red-700' :
                      session.metadata.complexity === 'medium' ? 'bg-yellow-100 text-yellow-700' :
                      'bg-green-100 text-green-700'
                    }`}>
                      {session.metadata.complexity}
                    </span>
                  </div>
                  <div>
                    <span className="text-blue-600 font-medium">è§£æ±ºçŠ¶æ³:</span>
                    <span className="ml-2 text-blue-800">
                      {session.metadata.resolved ? 'âœ… è§£æ±ºæ¸ˆã¿' : 'ğŸ”„ ç¶™ç¶šä¸­'}
                    </span>
                  </div>
                  <div>
                    <span className="text-blue-600 font-medium">ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—:</span>
                    <span className="ml-2 text-blue-800">
                      {session.metadata.followUpNeeded ? 'âš ï¸ å¿…è¦' : 'âœ… ä¸è¦'}
                    </span>
                  </div>
                </div>
              </div>

              <div className="bg-green-50 rounded-lg p-4">
                <h3 className="font-semibold text-green-900 mb-3">ğŸ“Š çµ±è¨ˆæƒ…å ±</h3>
                <div className="space-y-2 text-sm">
                  <div>
                    <span className="text-green-600 font-medium">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°:</span>
                    <span className="ml-2 text-green-800">{session.metadata.totalMessages}ä»¶</span>
                  </div>
                  <div>
                    <span className="text-green-600 font-medium">ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯:</span>
                    <span className="ml-2 text-green-800">{session.metadata.codeBlocks}å€‹</span>
                  </div>
                  <div>
                    <span className="text-green-600 font-medium">è³ªå•ã‚¿ã‚¤ãƒ—:</span>
                    <span className="ml-2 text-green-800">{session.metadata.questionType}</span>
                  </div>
                </div>
              </div>

              <div className="bg-purple-50 rounded-lg p-4">
                <h3 className="font-semibold text-purple-900 mb-3">ğŸ·ï¸ ã‚¹ãƒãƒ¼ãƒˆã‚¿ã‚°</h3>
                <div className="flex flex-wrap gap-1">
                  {session.metadata.autoGeneratedTags.map((tag: string, index: number) => (
                    <span 
                      key={index}
                      className="px-2 py-1 bg-purple-100 text-purple-700 rounded-full text-xs"
                    >
                      {tag}
                    </span>
                  ))}
                </div>
              </div>
            </div>

            {/* å³ã‚«ãƒ©ãƒ ï¼šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ */}
            <div className="lg:col-span-2">
              <div className="bg-gray-50 rounded-lg p-4">
                <h3 className="font-semibold text-gray-900 mb-4">ğŸ’¬ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ ({session.metadata.totalMessages}ä»¶)</h3>
                
                {session.messages && session.messages.length > 0 ? (
                  <div className="space-y-3 max-h-96 overflow-y-auto">
                    {session.messages.map((message: any, index: number) => (
                      <div 
                        key={index}
                        className={`p-3 rounded-lg border-l-4 ${
                          message.role === 'user' 
                            ? 'bg-blue-50 border-blue-500' 
                            : 'bg-green-50 border-green-500'
                        }`}
                      >
                        <div className="flex justify-between items-center mb-1">
                          <span className={`text-xs font-medium ${
                            message.role === 'user' ? 'text-blue-600' : 'text-green-600'
                          }`}>
                            {message.role === 'user' ? 'ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼' : 'ğŸ¤– AI'}
                          </span>
                          <span className="text-xs text-gray-500">
                            {new Date(message.timestamp).toLocaleString('ja-JP')}
                          </span>
                        </div>
                        <div className="text-sm text-gray-800 whitespace-pre-wrap">
                          {message.content || '(ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ãªã—)'}
                        </div>
                      </div>
                    ))}
                  </div>
                ) : (
                  <div className="text-center py-8 text-gray-500">
                    <p>ğŸ“ ã“ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
                    <p className="text-xs mt-2">Cursorã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™</p>
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  )
}

export default EnhancedSessions 